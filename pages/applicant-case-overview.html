<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../stylesheet/stylesheet.css">
    <link rel="stylesheet" href="../stylesheet/stylesheetSCSS.css">
    <link rel="stylesheet" href="../stylesheet/moreAnimations.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karla"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <title>Locate Advocate - Applicant Dashboard</title>
  </head>
  <body style="background-image:url(../pictures/website-bg.jpg);
  height: 100%;
  width: 100%;
  margin: 0%;
  background-repeat: no-repeat;
  background-size: cover;
  background-attachment: fixed;">

    <!--Navbar -->

    <div class="container-fluid bg-dblue">

        <header class="d-flex flex-wrap justify-content-center py-3">
          <a href="../Homepage.html" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
            <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"/></svg>
            <img src = "../pictures/laurels.png" style='width:50px;' class = "px-2">
            <span class="fs-4"><h1 class = "font-weight-bold text-white">Locate Advocate</h1></span>
          </a>
        </header>
    </div>
      
    <div class="d-flex bg-gold justify-content-end px-4">
        <div>
            <nav class ="navbar">
            <a class = "link-dotted link-light" href="./pages/login.html">Register</a> 
            <a class = "text-light text-decoration-none px-1">/</a>
            <a class = "link-dotted link-light" href="./pages/login.html">Log-in</a>
            </nav>
        </div>
    </div>

    <!--Body-->

    <div class="container bg-dblue pt-3 pb-2 mt-5 d-flex align-items-center justify-content-center">
      <div class="d-flex flex-column">
          <div class="d-flex justify-content-center text-light"><h4>Name of Case: <span id="caseName"></span></h4></div>
      </div>
    </div>

    <div class="container bg-gold pt-3 pb-2 d-flex align-items-center justify-content-center">
      <div class="d-flex flex-column">
          <div class="d-flex justify-content-center text-light"><h4>Case Status: <span id="caseStatus"></span></h4></div>
      </div>
    </div>

    <div class="container bg-beige p-4 px-5 mb-4">

      <div class="d-flex justify-content-center"><h4>Summary of Case Updates</h4></div>

      <a href="chat.html" class="block-link link-dark">
        <div class="d-flex justify-content-center m-5">  
          <div id="chatHere"><img src="../pictures/chat-gold.png" style="width: 2vw; height: auto;"> <span><b><u>Chat with Student Assistant</u></b></span></div>
        </div>
      </a>

      <div class="container">
        <!-- Section: Timeline -->
        <section class="">
          <style>
            .timeline-with-icons {
              border-left: 1px solid hsl(0, 0%, 90%);
              position: relative;
              list-style: none;
            }

            .timeline-with-icons .timeline-item {
              position: relative;
            }

            .timeline-with-icons .timeline-item:after {
              position: absolute;
              display: block;
              top: 0;
            }

            .timeline-with-icons .timeline-icon {
              position: absolute;
              left: -48px;
              background-color: #B29E79;
              color: #B29E79;
              border-radius: 50%;
              height: 31px;
              width: 31px;
              display: flex;
              align-items: center;
              justify-content: center;
            }
            .timeline-with-icons .timeline-current{
                background-color: #202837;
                color: #202837;
                position: absolute;
                left: -48px;
                border-radius: 50%;
                height: 31px;
                width: 31px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
          </style>

          <ul class="timeline-with-icons">
            <li class="timeline-item mb-5">
              <span id="awaitingAssignment" class="timeline-icon">
                <i class="fas fa-rocket text-primary fa-sm fa-fw"></i>
              </span>

              <h5 class="fw-bold">Awaiting Student Assistant Assignment</h5>
              <p class="text-muted mb-2 fw-bold" id="assignedDate">To be updated</p>
              <p class="text-muted">
                A student assistant will shortly be assigned to you.
              </p>
            </li>

            <li class="timeline-item mb-5">

              <span id="awaitingSummaryApproval" class="timeline-icon">
                <i class="fas fa-hand-holding-usd text-primary fa-sm fa-fw"></i>
              </span>
              <h5 class="fw-bold">Case Details Review</h5>
              <p class="text-muted mb-2 fw-bold">To be updated</p>
              <p class="text-muted">
                Please confirm that the facts of the case are accurate with the student assistant.                  
              </p>
            </li>

            <li class="timeline-item mb-5">

              <span id="awaitingAppointment" class="timeline-icon">
                <i class="fas fa-users text-primary fa-sm fa-fw"></i>
              </span>
              <h5 class="fw-bold">Awaiting Confirmed Appointment</h5>
              <p class="text-muted mb-2 fw-bold">To be updated</p>
              <p class="text-muted">
                 Awaiting appointment to be accepted by assigned lawyer.
              </p>
            </li>

            <li class="timeline-item mb-5">

              <span class="timeline-icon">
                <i class="fas fa-money-bill-wave text-primary fa-sm fa-fw"></i>
              </span>
              <h5 class="fw-bold">Appointment Confirmed</h5>
              <p class="text-muted mb-2 fw-bold">To be updated</p>
              <p class="text-muted">
                Your appointment has been confirmed. Please make sure to show up on time.
              </p>
            </li>
          </ul>
        </section>
        <!-- Section: Timeline -->

      </div>

      <h4>Action Items</h4>

      <div class="d-grid gap-2 mb-4" id="actionItems"></div>
      
      <div class="d-grid gap-2">
        <button class="btn btn-primary" type="button" onclick="dashboardReturn()">Back to Dashboard</button>
      </div>

    </div>

    <!--Footer-->

    <script>
      window.onload = console.log(sessionStorage);
      window.onload = retrieveCaseStatus();
      function dashboardReturn(){
        window.location.replace("applicant-start.html")
      }

      function retrieveCaseStatus(){
        var settings = {
          "url": "http://127.0.0.1:8100/get_cases_by_client",
          "method": "POST",
          "timeout": 0,
          "headers": {
            "Content-Type": "application/json"
          },
          "data": JSON.stringify({
            "client_id": sessionStorage.getItem("userID")
          }),
        };

        $.ajax(settings).done(function (response) {
          console.log(response);
          if (response.code == 200){
            document.getElementById("caseName").innerHTML = response.data.case_title;
            if (response.data.student_assigned_date == null){
              document.getElementById("awaitingAssignment").classList.remove("timeline-icon");
              document.getElementById("awaitingAssignment").classList.add("timeline-current");
              document.getElementById("caseStatus").innerHTML = "Awaiting Assignment";
              document.getElementById("chatHere").style.display = "none";
            }
            else if(response.data.finalised_case_summary_date == null){
              document.getElementById("assignedDate").innerHTML = "Completed: " + response.data.student_assigned_date;
              document.getElementById("awaitingSummaryApproval").classList.remove("timeline-icon");
              document.getElementById("awaitingSummaryApproval").classList.add("timeline-current");
              document.getElementById("caseStatus").innerHTML = "Case Detail Review";
              if(response.data.current_case_status == "Active"){
                document.getElementById("actionItems").innerHTML = `<button type="button" id="confirmSummary" class="rounded-corners btn btn-secondary btn-block">View case summary and confirm case summary</button>`;
              }
            }
            else if(response.data.confirmed_appointment_date == null){
              document.getElementById("awaitingAppointment").classList.remove("timeline-icon");
              document.getElementById("awaitingAppointment").classList.add("timeline-current");
              document.getElementById("caseStatus").innerHTML = "Awaiting Appointment Confirmation";
            }
            else{
              document.getElementById("confirmedAppointment").classList.remove("timeline-icon");
              document.getElementById("confirmedAppointment").classList.add("timeline-current");
              document.getElementById("caseStatus").innerHTML = "Appointment Confirmed";
            }
          }
        });
      }

    </script>

  </body>
  </html>