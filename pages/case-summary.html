<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../stylesheet/stylesheet.css">
    <link rel="stylesheet" href="../stylesheet/stylesheetSCSS.css">
    <link rel="stylesheet" href="../stylesheet/moreAnimations.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karla"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <title>Locate Advocate - Applicant Dashboard</title>
  </head>
  <body style="background-image:url(../pictures/website-bg.jpg);
  height: 100%;
  width: 100%;
  margin: 0%;
  background-repeat: no-repeat;
  background-size: cover;
  background-attachment: fixed;">

    <!--Navbar -->

    <div class="container-fluid bg-dblue">

        <header class="d-flex flex-wrap justify-content-center py-3">
          <a href="../Homepage.html" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
            <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"/></svg>
            <img src = "../pictures/laurels.png" style='width:50px;' class = "px-2">
            <span class="fs-4"><h1 class = "font-weight-bold text-white">Locate Advocate</h1></span>
          </a>
        </header>
    </div>
      
    <div class="d-flex bg-gold justify-content-end px-4">
        <div>
            <nav class ="navbar">
            <a class = "link-dotted link-light" href="./pages/login.html">Register</a> 
            <a class = "text-light text-decoration-none px-1">/</a>
            <a class = "link-dotted link-light" href="./pages/login.html">Log-in</a>
            </nav>
        </div>
    </div>

    <!--Body-->

    <div class="container p-4 px-5 mb-4">

      <div class="container-fluid">
        <!-- Section: Timeline -->
        <div class="row">
    
          <div class="col-6 col-md-6 bg-beige" style="padding: 0px;">
              <h5 class="bg-dblue text-light" style="text-align:center;">Most Recent Draft Received</h5>
              <span class = 'bg-dblue text-light m-2 px-2'>Date</span>
              <span id="case_date"></span>

              <div class="m-2 border border-secondary">
                <p class="px-1">
                  <u>Summary of facts</u><br>
                  <span id="summary_of_facts"></span>
                </p>
              </div>
              <div class="m-2 border border-secondary">
                <p class="px-1">
                  <u>Potential Issues/Legal Questions</u><br>
                  <span id="issues_questions"></span>
                </p>
              </div>
              <div class="m-2 border border-secondary">
                <p class="px-1">
                  <u>Applicable Law (Common Law topics or statues, be as specific as possible)</u><br>
                  <span id="applicable_law"></span>
                </p>
              </div>
              <div class="m-2 border border-secondary">
                <p class="px-1">
                  <u>Court Hearing the Matter</u><br>
                  <span id="court_hearing_matter"></span>
                </p>
              </div>
              <div class="m-2 border border-secondary">
                <p class="px-1">
                  <u>Any specific questions on procedure or law the applicant has</u><br>
                  <span id="specific_questions"></span>
                </p>
              </div>

          </div>
          <div class="col-1 col-md-1"></div>
          
          <!-- Section: Timeline -->
          <div class="col-5 col-md-5 bg-beige p-0 position-relative">

            <h5 class="bg-dblue text-light" style="text-align:center;">Summary Submission Log</h5>
            <section class='p-2 px-5'>
              <style>
                .timeline-with-icons {
                  border-left: 1px solid hsl(0, 0%, 90%);
                  position: relative;
                  list-style: none;
                }
    
                .timeline-with-icons .timeline-item {
                  position: relative;
                }
    
                .timeline-with-icons .timeline-item:after {
                  position: absolute;
                  display: block;
                  top: 0;
                }
    
                .timeline-with-icons .timeline-icon {
                  position: absolute;
                  left: -48px;
                  background-color: #B29E79;
                  color: #B29E79;
                  border-radius: 50%;
                  height: 31px;
                  width: 31px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                }
    
                .timeline-with-icons .timeline-current{
                    background-color: #202837;
                    color: #202837;
                    position: absolute;
                    left: -48px;
                    border-radius: 50%;
                    height: 31px;
                    width: 31px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
              </style>
    
              <ul class="timeline-with-icons" id="timeline" style="display: none;" >
                <li class="timeline-item mb-5" style="display:none;" id="latest_draft">
                  <span class="timeline-current">
                    <i class="fas fa-rocket text-primary fa-sm fa-fw"></i>
                  </span>
    
                  <h5 class="fw-bold">Latest Draft Received</h5>
                  <p class="text-muted mb-2 fw-bold" id="case_summary_date"></p>
                </li>
    
                <li class="timeline-item mb-5" style="display:none;" id="final_draft">
                  <span class="timeline-icon">
                    <i class="fas fa-users text-primary fa-sm fa-fw"></i>
                  </span>
                  <h5 class="fw-bold">Final Draft Received</h5>
                  <p class="text-muted mb-2 fw-bold" id="finalized_case_summary_date"></p>
                </li>
    
              </ul>
              <!-- <button class="border border-dark position-absolute start-50 " style="text-align: center;">Approve draft</button> -->
            </section>
            <div class="container-fluid d-flex justify-content-center" style="margin-bottom: 30px;">
              <div id="approval" style="display: none;">
                <button class="border border-dark bg-dblue text-light mx-3">Approve Latest Draft</button>
                <button class="text-light bg-gold mx-3" style="border: none;" onclick="addEdits()">Request Edits</button>
              </div>
            </div>

            <div style="display: none;" id="request-edits">
              <h5 class="bg-dblue text-light" style="text-align:center;">Edits Requested by Applicant</h5> 
              <form class="m-2">
                <div class="input-group">
                  <textarea class="form-control" aria-label="With textarea" id=""client-req></textarea>
                </div>
                <div class="container-fluid d-flex justify-content-center">
                  <button class="text-light m-3 bg-gold" style="margin-bottom: 15px; border: none;">Submit Request</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const user_id = localStorage.getItem("user_id");
      const case_id = localStorage.getItem("case_id");

      window.onload = loadDrafts();
      function loadDrafts() {
        const xhttp = new XMLHttpRequest();
        xhttp.onload = function() {
          let draft_info_arr = JSON.parse(this.responseText).data;
          // console.log(this.responseText);
          
          for (draft_info of draft_info_arr){
            //logic flow for requesting edits 
            if (draft_info.finalised_case_summary_date != "" || draft_info.case_summary_date != "") {
              // case whereby the entire case has previously been approved 
              if (draft_info.case_summary_date != "" && draft_info.finalised_case_summary_date != ""){
                document.getElementById('timeline').style.display="";
                document.getElementById('latest_draft').style.display="";
                document.getElementById('final_draft').style.display="";
                let case_summary_date = draft_info.case_summary_date;
                case_summary_date = moment(case_summary_date).format('LL'); 
                let finalized_case_summary_date = draft_info.finalized_case_summary_date;
                finalized_case_summary_date = moment(finalized_case_summary_date).format('LL'); 
                document.getElementById('case_summary_date').innerHTML = case_summary_date;
                document.getElementById('finalized_case_summary_date').innerHTML = finalized_case_summary_date;
              }
              // case whereby approval is pending 
              else if (draft_info.finalised_case_summary_date == ""){
                document.getElementById('timeline').style.display="";
                document.getElementById('latest_draft').style.display="";
                let case_summary_date = draft_info.case_summary_date;
                case_summary_date = moment(case_summary_date).format('LL'); 
                document.getElementById('case_summary_date').innerHTML = case_summary_date;
                document.getElementById('approval').style.display = "";
              }
            }

            //populating fields on the left 
            let case_date = draft_info.case_summary_date;
            case_date = moment(case_date).format('LL'); 
            document.getElementById('case_date').innerHTML = case_date;
            document.getElementById('summary_of_facts').innerHTML = draft_info.summary_of_facts;
            document.getElementById('issues_questions').innerHTML = draft_info.issues_questions;
            document.getElementById('applicable_law').innerHTML = draft_info.applicable_law;
            document.getElementById('court_hearing_matter').innerHTML = draft_info.court_hearing_matter;
            document.getElementById('specific_questions').innerHTML = draft_info.specific_questions;
          }

        }
        xhttp.open("GET", "http://localhost:5000/get_draft_details", true);
        xhttp.setRequestHeader("Content-Type", "application/json");
        xhttp.send();
      }

      function addEdits(){
        document.getElementById('approval').style.display = "none";
        document.getElementById('request-edits').style.display = "";
      }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> 
  </body>
  </html>